<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–†–∞—Å—á—ë—Ç –æ–ø–ª–∞—Ç—ã –∑–∞–ª–∞</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding: 16px;
}
h2 { margin-top: 0; }
input {
  width: 100%;
  padding: 8px;
  margin: 6px 0 14px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}
.hour-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}
.hour-row span {
  width: 80px;
}
button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
  cursor: pointer;
}
.preview { background: #2563eb; color: white; }
.send { background: #16a34a; color: white; }
.reset { background: #dc2626; color: white; }
.box {
  background: #020617;
  padding: 12px;
  border-radius: 10px;
  margin-top: 14px;
  white-space: pre-wrap;
}
.small { font-size: 14px; color: #94a3b8; }
</style>
</head>

<body>

<h2 id="date"></h2>

<label>üíµ –¶–µ–Ω–∞ –∑–∞–ª–∞ –∑–∞ 1 —á–∞—Å</label>
<input type="number" id="price">

<label>üïë –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ –∞—Ä–µ–Ω–¥—ã</label>
<input type="number" id="hours" min="1" max="24">

<label>üë• –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤</label>
<input type="number" id="players" min="1" max="50">

<div id="hoursBlock"></div>
<div class="small" id="left"></div>

<button class="preview" onclick="preview()">üëÄ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
<button class="reset" onclick="resetAll()">üîÑ –û—á–∏—Å—Ç–∏—Ç—å</button>
<button class="send" onclick="send()">‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram</button>

<div id="previewBox" class="box" style="display:none"></div>

<script>
Telegram.WebApp.ready();
Telegram.WebApp.expand();

const dateEl = document.getElementById('date');
const today = new Date();
const days = ['–í–û–°–ö–†–ï–°–ï–ù–¨–ï','–ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö','–í–¢–û–†–ù–ò–ö','–°–†–ï–î–ê','–ß–ï–¢–í–ï–†–ì','–ü–Ø–¢–ù–ò–¶–ê','–°–£–ë–ë–û–¢–ê'];
dateEl.textContent = `üìÖ ${days[today.getDay()]} ${today.toLocaleDateString('ru-RU')}`;

document.getElementById('hours').addEventListener('input', buildHours);

function buildHours() {
  const hours = Number(hoursInput.value);
  const block = document.getElementById('hoursBlock');
  block.innerHTML = '<h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —á–∞—Å–∞–º</h3>';

  for (let i = 1; i <= hours; i++) {
    block.innerHTML += `
      <div class="hour-row">
        <span>${i} —á–∞—Å</span>
        <input type="number" min="0" data-hour="${i}">
      </div>`;
  }
}

function preview() {
  const data = collectData();
  if (!data) return;

  document.getElementById('previewBox').style.display = 'block';
  document.getElementById('previewBox').textContent =
`üìÖ ${data.date}

–û–ü–õ–ê–¢–ê –ó–ê –ó–ê–õ
–¶–µ–Ω–∞: ${data.price}‚ÇΩ / —á–∞—Å
–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: ${data.players}

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:
${data.dist.map(d => `${d.count} —á–µ–ª–æ–≤–µ–∫ ‚Äî ${d.hour} —á–∞—Å`).join('\n')}`;
}

function send() {
  const data = collectData();
  if (!data) return;
  Telegram.WebApp.sendData(JSON.stringify(data));
}

function resetAll() {
  document.querySelectorAll('input').forEach(i => i.value = '');
  document.getElementById('hoursBlock').innerHTML = '';
  document.getElementById('previewBox').style.display = 'none';
}

function collectData() {
  const price = Number(priceInput.value);
  const hours = Number(hoursInput.value);
  const players = Number(playersInput.value);
  const dist = [];

  let sum = 0;
  document.querySelectorAll('[data-hour]').forEach(i => {
    const v = Number(i.value);
    if (v) {
      sum += v;
      dist.push({hour: i.dataset.hour, count: v});
    }
  });

  if (!price || !hours || !players) {
    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
    return null;
  }

  if (sum > players) {
    alert('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤');
    return null;
  }

  return {
    date: dateEl.textContent.replace('üìÖ ',''),
    price, hours, players, dist
  };
}
</script>

</body>
</html>
