<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ–ø–ª–∞—Ç—ã –∑–∞–ª–∞</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7; }
  h2 { color: #333; }
  input, button { padding: 10px; margin: 5px 0; width: 100%; font-size: 16px; }
  .hour-buttons button { width: 30%; margin: 5px; }
  .summary { background: #fff; padding: 10px; margin-top: 10px; border-radius: 5px; }
</style>
</head>
<body>

<h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ–ø–ª–∞—Ç—ã –∑–∞–ª–∞ üèê</h2>

<label>–°—É–º–º–∞ –∑–∞–ª–∞ –∑–∞ 1 —á–∞—Å:</label>
<input type="number" id="hallPrice" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 1500">

<label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ –∞—Ä–µ–Ω–¥—ã:</label>
<input type="number" id="totalHours" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 5" min="1" max="6">

<label>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:</label>
<input type="number" id="totalPlayers" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 20" min="1">

<button onclick="startDistribution()">–ù–∞—á–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</button>

<div id="hoursDiv" style="display:none;">
  <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —á–∞—Å–∞–º ‚è±</h3>
  <div class="hour-buttons" id="hourButtons"></div>
  <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —á–∞—Å–∞:</label>
  <input type="number" id="playersForHour" min="1">
  <button onclick="addPlayers()">–î–æ–±–∞–≤–∏—Ç—å</button>
  <p id="remaining"></p>
</div>

<div class="summary" id="previewDiv" style="display:none;">
  <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞ üìÑ</h3>
  <pre id="previewText"></pre>
  <button onclick="sendReport()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç ‚úÖ</button>
</div>

<script>
let hallPrice = 0;
let totalHours = 0;
let totalPlayers = 0;
let playersByHours = {};
let currentHour = null;

function startDistribution() {
  hallPrice = Number(document.getElementById('hallPrice').value);
  totalHours = Number(document.getElementById('totalHours').value);
  totalPlayers = Number(document.getElementById('totalPlayers').value);

  if (!hallPrice || !totalHours || !totalPlayers) {
    alert("–í–≤–µ–¥–∏—Ç–µ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
    return;
  }

  playersByHours = {};
  document.getElementById('hoursDiv').style.display = 'block';
  renderHourButtons();
  updateRemaining();
}

function renderHourButtons() {
  const container = document.getElementById('hourButtons');
  container.innerHTML = '';
  for (let i=1;i<=totalHours;i++){
    const btn = document.createElement('button');
    btn.innerText = `${i} —á–∞—Å${i>1?'–∞':''}`;
    btn.onclick = ()=>{currentHour=i;};
    container.appendChild(btn);
  }
}

function addPlayers() {
  const val = Number(document.getElementById('playersForHour').value);
  if (!currentHour) { alert('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Å!'); return; }
  if (!val || val < 1) { alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤'); return; }

  const already = Object.values(playersByHours).reduce((a,b)=>a+b,0);
  if (already + val > totalPlayers) { alert('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤'); return; }

  playersByHours[currentHour] = val;
  updateRemaining();
  renderPreview();
}

function updateRemaining() {
  const sum = Object.values(playersByHours).reduce((a,b)=>a+b,0);
  document.getElementById('remaining').innerText = `–û—Å—Ç–∞–ª–æ—Å—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å: ${totalPlayers - sum} —á–µ–ª–æ–≤–µ–∫`;
}

function renderPreview() {
  document.getElementById('previewDiv').style.display='block';
  let text = `–û–ü–õ–ê–¢–ê –ó–ê –ó–ê–õ üèê\n–°—É–º–º–∞ –∑–∞ 1 —á–∞—Å: ${hallPrice}‚ÇΩ\n–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤: ${totalHours}\n–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: ${totalPlayers}\n\n`;
  text += '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —á–∞—Å–∞–º:\n';
  for (let h in playersByHours){
    text += `${h} —á–∞—Å(–∞): ${playersByHours[h]} —á–µ–ª–æ–≤–µ–∫\n`;
  }

  // –ü–æ–¥—Å—á—ë—Ç —Å—É–º–º—ã
  const playersInHour = {};
  for(let h=1;h<=totalHours;h++){ 
    playersInHour[h] = 0;
    for(let ph in playersByHours){
      if(Number(ph) >= h) playersInHour[h]+=playersByHours[ph];
    }
  }

  for(let ph in playersByHours){
    let sumPerPerson=0;
    for(let h=1;h<=ph;h++) sumPerPerson+=hallPrice/playersInHour[h];
    sumPerPerson = Math.ceil(sumPerPerson/10)*10;
    text += `–°—É–º–º–∞ –∑–∞ ${ph} —á–∞—Å(–∞) –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞: ${sumPerPerson}‚ÇΩ\n`;
  }

  document.getElementById('previewText').innerText = text;
}

function sendReport() {
  const data = {
    hallPrice, totalHours, totalPlayers, playersByHours
  };
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
  Telegram.WebApp.sendData(JSON.stringify(data));
  alert('–û—Ç—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –±–æ—Ç—É!');
}
</script>
</body>
</html>