<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ß–∞—Ä—á—É–ª—è—Ç–æ—Ä</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* –í–µ—Å—å CSS —Å—Ç–∏–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        /* CSS –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
        :root {
            --primary-gradient: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            --primary-color: #1a2980;
            --secondary-color: #26d0ce;
            --success-color: #27ae60;
            --warning-color: #ff9800;
            --error-color: #e74c3c;
            --bg-color: #fff;
            --text-color: #333;
            --border-color: #ddd;
            --card-bg: #f8f9fa;
            --shadow: 0 15px 50px rgba(0,0,0,0.3);
            --validation-bg: #fff8e1;
            --validation-border: #ffb300;
            --validation-success-bg: #e8f5e9;
            --validation-error-bg: #ffebee;
            --status-bg: #e3f2fd;
            --status-border: #2196f3;
            --disabled-opacity: 0.6;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --primary-gradient: linear-gradient(135deg, #0d1525 0%, #1a3a3a 100%);
                --primary-color: #4a6ee0;
                --secondary-color: #2ca3a1;
                --bg-color: #1a1a1a;
                --text-color: #f0f0f0;
                --border-color: #444;
                --card-bg: #2d2d2d;
                --shadow: 0 15px 50px rgba(0,0,0,0.6);
                --validation-bg: #332900;
                --validation-border: #ffb300;
                --validation-success-bg: #1a2c1a;
                --validation-error-bg: #330a0a;
                --status-bg: #0a1929;
                --status-border: #2196f3;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: var(--primary-gradient);
            min-height: 100vh;
            padding: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            -webkit-text-size-adjust: 100%;
            touch-action: pan-y;
            color: var(--text-color);
            background-color: var(--bg-color);
        }
        
        .container {
            background: var(--bg-color);
            border-radius: 20px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 700px;
            padding: 25px;
            animation: slideUp 0.4s ease;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                border-radius: 15px;
                margin: 10px;
                animation: none !important;
            }
            
            body {
                padding: 10px;
                align-items: flex-start;
                min-height: 100vh;
            }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .header {
                margin-bottom: 15px;
                padding-bottom: 10px;
            }
        }
        
        .header h1 {
            color: var(--primary-color);
            font-size: 26px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .date-display {
            color: #666;
            font-size: 14px;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .main-date {
            color: var(--primary-color);
            font-size: 24px;
            font-weight: 700;
            margin: 0;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 22px;
            }
            
            .main-date {
                font-size: 20px;
            }
        }
        
        .input-section {
            margin-bottom: 20px;
        }
        
        .basic-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .basic-inputs {
                grid-template-columns: 1fr;
                gap: 10px;
                margin-bottom: 15px;
            }
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .input-group {
                margin-bottom: 10px;
            }
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 14px;
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            z-index: 2;
        }
        
        .input-with-icon input {
            width: 100%;
            padding: 14px 14px 14px 45px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background: var(--bg-color);
            color: var(--text-color);
        }
        
        @media (max-width: 768px) {
            .input-with-icon input {
                padding: 12px 12px 12px 45px;
                font-size: 15px;
            }
        }
        
        .input-with-icon input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.1);
            outline: none;
        }
        
        .players-section {
            margin-top: 25px;
        }
        
        @media (max-width: 768px) {
            .players-section {
                margin-top: 15px;
            }
        }
        
        .section-title {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .section-title {
                font-size: 16px;
                margin-bottom: 10px;
            }
        }
        
        .hours-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .hours-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
        }
        
        .hour-group {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--border-color);
            transition: all 0.3s;
        }
        
        @media (max-width: 768px) {
            .hour-group {
                padding: 15px;
            }
        }
        
        .hour-group:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .hour-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .hour-title {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 16px;
        }
        
        @media (max-width: 768px) {
            .hour-title {
                font-size: 14px;
            }
        }
        
        .hour-input-group {
            margin-bottom: 10px;
        }
        
        .hour-input-label {
            display: block;
            color: var(--text-color);
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: 500;
            text-align: center;
        }
        
        .hour-input {
            width: 100%;
            text-align: center;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background: var(--bg-color);
            color: var(--text-color);
        }
        
        @media (max-width: 768px) {
            .hour-input {
                padding: 8px;
                font-size: 15px;
            }
        }
        
        .hour-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: not-allowed;
            transition: all 0.3s;
            margin-top: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            opacity: 0.6;
        }
        
        @media (max-width: 768px) {
            .calculate-btn {
                padding: 16px;
                font-size: 16px;
                margin-top: 20px;
            }
        }
        
        .calculate-btn.active {
            background: var(--success-color);
            cursor: pointer;
            opacity: 1;
        }
        
        .calculate-btn.active:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }
        
        .result-section {
            margin-top: 30px;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @media (max-width: 768px) {
            .result-section {
                margin-top: 20px;
                padding: 15px;
                border-radius: 12px;
                animation: none !important;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-color);
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .result-header {
                font-size: 18px;
                margin-bottom: 15px;
            }
        }
        
        .report-box {
            background: var(--bg-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 4px solid var(--secondary-color);
            white-space: pre-line;
            line-height: 1.6;
            font-size: 16px;
            color: var(--text-color);
        }
        
        @media (max-width: 768px) {
            .report-box {
                padding: 15px;
                font-size: 15px;
                line-height: 1.5;
            }
        }
        
        .footer {
            text-align: center;
            margin-top: 25px;
            color: #666;
            font-size: 13px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        @media (max-width: 768px) {
            .footer {
                margin-top: 15px;
                padding-top: 15px;
                font-size: 12px;
            }
        }
        
        .copy-btn {
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        @media (max-width: 768px) {
            .copy-btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
        
        .copy-btn:hover {
            background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }
        
        .copy-btn.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }
        
        .telegram-btn {
            background: linear-gradient(135deg, #0088cc 0%, #1e96c8 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            margin-left: 10px;
        }
        
        @media (max-width: 768px) {
            .telegram-btn {
                padding: 10px 20px;
                font-size: 14px;
                margin-left: 0;
                margin-top: 10px;
            }
        }
        
        .telegram-btn:hover {
            background: linear-gradient(135deg, #0077b5 0%, #1a87b5 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
        }
        
        .telegram-btn.sending {
            background: #7f8c8d;
            cursor: not-allowed;
        }
        
        .telegram-btn.success {
            background: #27ae60;
        }
        
        .telegram-btn.error {
            background: #e74c3c;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 25px;
        }
        
        @media (max-width: 768px) {
            .actions {
                margin-top: 15px;
                flex-direction: column;
                align-items: center;
            }
        }
        
        .validation-message {
            background: var(--validation-bg);
            border-radius: 10px;
            padding: 12px 15px;
            margin: 15px 0;
            border-left: 4px solid var(--validation-border);
            font-size: 14px;
            display: none;
            color: var(--text-color);
        }
        
        @media (max-width: 768px) {
            .validation-message {
                padding: 10px 12px;
                margin: 10px 0;
                font-size: 13px;
            }
        }
        
        .validation-message.error {
            background: var(--validation-error-bg);
            border-left-color: var(--error-color);
        }
        
        .validation-message.success {
            background: var(--validation-success-bg);
            border-left-color: var(--success-color);
        }
        
        .status-message {
            background: var(--status-bg);
            border-radius: 10px;
            padding: 12px 15px;
            margin: 15px 0;
            border-left: 4px solid var(--status-border);
            font-size: 14px;
            display: none;
            text-align: center;
            animation: fadeIn 0.3s ease;
            color: var(--text-color);
        }
        
        @media (max-width: 768px) {
            .status-message {
                padding: 10px 12px;
                margin: 10px 0;
                font-size: 13px;
            }
        }
        
        .status-message.success {
            background: var(--validation-success-bg);
            border-left-color: #4caf50;
        }
        
        .status-message.error {
            background: var(--validation-error-bg);
            border-left-color: #f44336;
        }
        
        .total-cost-preview {
            text-align: center;
            margin: 10px 0 20px;
            padding: 10px;
            background: var(--card-bg);
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-color);
            border: 1px solid var(--border-color);
            display: none;
        }
        
        @media (max-width: 768px) {
            .total-cost-preview {
                margin: 5px 0 15px;
                padding: 8px;
                font-size: 15px;
            }
        }
        
        @media (max-width: 400px) {
            .hours-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .hour-group {
                padding: 12px;
            }
            
            .hour-title {
                font-size: 13px;
            }
            
            .hour-input {
                padding: 6px;
                font-size: 14px;
            }
        }
        
        @media screen and (max-width: 768px) {
            input, textarea, select {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="main-date" id="currentDate"></div>
        </div>
        
        <div class="input-section">
            <div class="basic-inputs">
                <div class="input-group">
                    <label>
                        <i class="fas fa-money-bill-wave"></i> –¶–µ–Ω–∞ –∑–∞–ª–∞ –∑–∞ 1 —á–∞—Å (‚ÇΩ)
                    </label>
                    <div class="input-with-icon">
                        <i class="fas fa-ruble-sign"></i>
                        <input type="text" 
                               id="hallPrice" 
                               inputmode="numeric"
                               pattern="[0-9]*"
                               placeholder="700-10000"
                               aria-label="–¶–µ–Ω–∞ –∑–∞–ª–∞ –∑–∞ —á–∞—Å">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>
                        <i class="fas fa-clock"></i> –ß–∞—Å–æ–≤ –∞—Ä–µ–Ω–¥—ã –∑–∞–ª–∞
                    </label>
                    <div class="input-with-icon">
                        <i class="fas fa-clock"></i>
                        <input type="text" 
                               id="hours" 
                               inputmode="numeric"
                               pattern="[0-9]*"
                               placeholder="1-24"
                               aria-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ –∞—Ä–µ–Ω–¥—ã">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>
                        <i class="fas fa-users"></i> –í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤
                    </label>
                    <div class="input-with-icon">
                        <i class="fas fa-user"></i>
                        <input type="text" 
                               id="totalPlayers" 
                               inputmode="numeric"
                               pattern="[0-9]*"
                               placeholder="1-35"
                               aria-label="–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤">
                    </div>
                </div>
            </div>
            
            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ -->
            <div class="total-cost-preview" id="totalCostPreview">
                <i class="fas fa-calculator"></i> –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ª–∞: <span id="totalCostValue">0</span> ‚ÇΩ
            </div>
            
            <div class="validation-message" id="validationMessage" role="alert" aria-live="polite"></div>
            
            <div class="players-section">
                <div class="section-title">
                    <i class="fas fa-user-clock"></i> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —á–∞—Å–∞–º
                </div>
                
                <div class="hours-grid" id="hoursContainer" role="group" aria-label="–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —á–∞—Å–∞–º">
                    <!-- –ß–∞—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
        
        <button class="calculate-btn" id="calculateBtn" aria-label="–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–ø–ª–∞—Ç—É">
            <i class="fas fa-calculator"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
        </button>
        
        <div class="result-section" id="resultSection" role="region" aria-label="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞">
            <div class="result-header">
                <i class="fas fa-file-invoice-dollar"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞
            </div>
            
            <div class="report-box" id="reportBox" role="status" aria-live="polite">
                <!-- –û—Ç—á—ë—Ç –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω —Å—é–¥–∞ -->
            </div>
            
            <div class="status-message" id="statusMessage" role="alert" aria-live="polite"></div>
            
            <div class="actions">
                <button class="copy-btn" id="copyBtn" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç">
                    <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </button>
                <button class="telegram-btn" id="telegramBtn" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram">
                    <i class="fab fa-telegram"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
                </button>
            </div>
        </div>
        
        <div class="footer">
            <!-- –§—É—Ç–µ—Ä –æ—Å—Ç–∞–≤–ª–µ–Ω –ø—É—Å—Ç—ã–º –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É -->
        </div>
    </div>
    
    <script>
        // ===========================================
        // –ù–ê–°–¢–†–ê–ò–í–ê–ï–ú–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ (–ò–ó–ú–ï–ù–Ø–ô–¢–ï –ó–î–ï–°–¨)
        // ===========================================
        const APP_CONFIG = {
            // Telegram –±–æ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            TELEGRAM: {
                TOKEN: '8451836523:AAF7DOw-r1S9zhXkuxub7IFEzkv-XiHiKnw',     // –¢–æ–∫–µ–Ω –±–æ—Ç–∞
                CHAT_ID: -1003677318941,                                   // ID —á–∞—Ç–∞/–∫–∞–Ω–∞–ª–∞
                RESULT_THREAD_ID: 8                                         // ID –≤–µ—Ç–∫–∞(–µ—Å–ª–∏ –µ—Å—Ç—å)
            },
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
            CALCULATOR: {
                MIN_HALL_PRICE: 700,        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞–ª–∞
                MAX_HALL_PRICE: 10000,      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞–ª–∞
                MIN_HOURS: 1,               // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤
                MAX_HOURS: 24,              // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤
                MIN_PLAYERS: 1,             // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤
                MAX_PLAYERS: 35,            // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤
                DEFAULT_STEP: 100           // –®–∞–≥ –¥–ª—è —Ü–µ–Ω—ã –∑–∞–ª–∞
            },
            
            // –¢–µ–∫—Å—Ç –¥–ª—è –æ—Ç—á–µ—Ç–∞
            REPORT: {
                BANK_NAME: '–°–ë–ï–†–ë–ê–ù–ö / –¢–ò–ù–¨–ö–û–í',
                PHONE_NUMBER: '+79264478622 –ê–Ω–∞—Å—Ç–∞—Å–∏—è –°',
                FOOTER_TEXT: '‚ú® –•–≤–æ—Å—Ç–∏–∫–∏ –∏ –±–æ–Ω—É—Å—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è!\n‚òïÔ∏è –ü–æ–∫—É–ø–∞–µ–º —Å–ø–æ—Ä—Ç–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, —á–∞–π –∏ –∫–æ—Ñ–µ\nüôè –í—Å–µ–º —Å–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É!'
            },
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ UI
            UI: {
                APP_NAME: '–ß–∞—Ä—á—É–ª—è—Ç–æ—Ä',
                PRIMARY_COLOR: '#1a2980',
                SECONDARY_COLOR: '#26d0ce'
            }
        };
        // ===========================================
        // –ö–û–ù–ï–¶ –ù–ê–°–¢–†–ê–ò–í–ê–ï–ú–´–• –ü–ê–†–ê–ú–ï–¢–†–û–í
        // ===========================================
    </script>
    
    <script>
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', function() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
            const CONFIG = window.APP_CONFIG || APP_CONFIG;
            
            // –ö—ç—à DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const DOMCache = {
                elements: {},
                get: function(id) {
                    if (!this.elements[id]) {
                        this.elements[id] = document.getElementById(id);
                    }
                    return this.elements[id];
                },
                getAll: function(selector) {
                    const key = selector.replace(/[.#\s]/g, '_');
                    if (!this.elements[key]) {
                        this.elements[key] = document.querySelectorAll(selector);
                    }
                    return this.elements[key];
                },
                // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ—á–∏—â–µ–Ω–∏–µ –∫—ç—à–∞ - —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                clearHourInputsCache: function() {
                    this.elements['#hoursContainer_input'] = null;
                }
            };
            
            // –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å DOM
            const DOMUtils = {
                show: function(element, display = 'block') {
                    if (element) {
                        element.style.display = display;
                    }
                },
                hide: function(element) {
                    if (element) {
                        element.style.display = 'none';
                    }
                },
                toggle: function(element, display = 'block') {
                    if (element) {
                        element.style.display = element.style.display === 'none' ? display : 'none';
                    }
                },
                addClass: function(element, className) {
                    if (element) {
                        element.classList.add(className);
                    }
                },
                removeClass: function(element, className) {
                    if (element) {
                        element.classList.remove(className);
                    }
                },
                setText: function(element, text) {
                    if (element) {
                        element.textContent = text;
                    }
                },
                setHTML: function(element, html) {
                    if (element) {
                        element.innerHTML = html;
                    }
                }
            };
            
            // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Telegram Web App
            const isTelegramWebApp = window.Telegram && window.Telegram.WebApp;
            
            if (isTelegramWebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                Telegram.WebApp.setHeaderColor(CONFIG.UI.PRIMARY_COLOR);
                Telegram.WebApp.setBackgroundColor('#f8f9fa');
                
                const theme = Telegram.WebApp.colorScheme;
                if (theme === 'dark') {
                    document.documentElement.style.setProperty('--bg-color', '#1a1a1a');
                    document.documentElement.style.setProperty('--text-color', '#ffffff');
                }
            }
            
            // –î–µ–±–∞—É–Ω—Å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const hallPrice = DOMCache.get('hallPrice');
            const hoursInput = DOMCache.get('hours');
            const totalPlayers = DOMCache.get('totalPlayers');
            const hoursContainer = DOMCache.get('hoursContainer');
            const calculateBtn = DOMCache.get('calculateBtn');
            const resultSection = DOMCache.get('resultSection');
            const reportBox = DOMCache.get('reportBox');
            const copyBtn = DOMCache.get('copyBtn');
            const telegramBtn = DOMCache.get('telegramBtn');
            const validationMessage = DOMCache.get('validationMessage');
            const statusMessage = DOMCache.get('statusMessage');
            const totalCostPreview = DOMCache.get('totalCostPreview');
            const totalCostValue = DOMCache.get('totalCostValue');
            
            // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            let hourInputs = []; // –ö—ç—à –∏–Ω–ø—É—Ç–æ–≤ —á–∞—Å–æ–≤
            let hourElements = []; // –ö—ç—à —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —á–∞—Å–æ–≤
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            function getDateInfo() {
                const now = new Date();
                const days = ['–í–û–°–ö–†–ï–°–ï–ù–¨–ï', '–ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö', '–í–¢–û–†–ù–ò–ö', '–°–†–ï–î–ê', '–ß–ï–¢–í–ï–†–ì', '–ü–Ø–¢–ù–ò–¶–ê', '–°–£–ë–ë–û–¢–ê'];
                const dayOfWeek = days[now.getDay()];
                
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = now.getFullYear();
                
                return `${dayOfWeek} ${day}.${month}.${year}`;
            }
            
            DOMUtils.setText(DOMCache.get('currentDate'), getDateInfo());
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            function parseNumber(value) {
                // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—É—Å—Ç–æ–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 0
                if (!value || value.trim() === '') return 0;
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–æ
                const num = parseInt(value, 10);
                return isNaN(num) ? 0 : num;
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤–≤–æ–¥–∞ –æ—Ç –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
            function sanitizeNumericInput(value) {
                return value.replace(/\D/g, '');
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–≤–æ–¥–∞ —á–∏—Å–µ–ª (–º—è–≥–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ blur –∏–ª–∏ —Ä–∞—Å—á–µ—Ç–µ)
            function validateNumericValue(value, min, max) {
                // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—É—Å—Ç–æ–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
                if (value === '' || value === null || value === undefined) {
                    return '';
                }
                
                // –û—á–∏—â–∞–µ–º –æ—Ç –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                const numericValue = sanitizeNumericInput(value.toString());
                
                // –ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
                if (numericValue === '') {
                    return '';
                }
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–æ
                const num = parseInt(numericValue, 10);
                
                // –ï—Å–ª–∏ –Ω–µ —á–∏—Å–ª–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
                if (isNaN(num)) {
                    return '';
                }
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ, –∞ –Ω–µ –ø—Ä–∏ –≤–≤–æ–¥–µ
                return num.toString();
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Ä–∞—Å—á–µ—Ç–æ–º
            function finalizeNumericValue(value, min, max) {
                const num = parseNumber(value);
                
                if (num === 0) {
                    return min.toString(); // –ï—Å–ª–∏ –ø—É—Å—Ç–æ, —Å—Ç–∞–≤–∏–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                }
                
                if (num < min) {
                    return min.toString();
                }
                
                if (num > max) {
                    return max.toString();
                }
                
                return num.toString();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
            function updateTotalCostPreview() {
                const price = parseNumber(hallPrice.value);
                const hours = parseNumber(hoursInput.value);
                
                if (price > 0 && hours > 0) {
                    const totalCost = price * hours;
                    DOMUtils.setText(totalCostValue, totalCost.toLocaleString('ru-RU'));
                    DOMUtils.show(totalCostPreview);
                } else {
                    DOMUtils.hide(totalCostPreview);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤—ã—Ö –ø–æ–ª–µ–π
            function validateBaseFields() {
                const price = parseNumber(hallPrice.value);
                const hours = parseNumber(hoursInput.value);
                const totalPlayersCount = parseNumber(totalPlayers.value);
                
                const isValidPrice = price >= CONFIG.CALCULATOR.MIN_HALL_PRICE && 
                                   price <= CONFIG.CALCULATOR.MAX_HALL_PRICE;
                const isValidHours = hours >= CONFIG.CALCULATOR.MIN_HOURS && 
                                   hours <= CONFIG.CALCULATOR.MAX_HOURS;
                const isValidPlayers = totalPlayersCount >= CONFIG.CALCULATOR.MIN_PLAYERS && 
                                     totalPlayersCount <= CONFIG.CALCULATOR.MAX_PLAYERS;
                
                return {
                    price, hours, totalPlayersCount,
                    isValid: isValidPrice && isValidHours && isValidPlayers,
                    isValidPrice, isValidHours, isValidPlayers
                };
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤
            function validateDistribution() {
                const baseFields = validateBaseFields();
                if (!baseFields.isValid) return { isValid: false, sumPlayers: 0 };
                
                let sumPlayers = 0;
                let hasInputs = false;
                
                hourInputs.forEach(input => {
                    const value = parseNumber(input.value);
                    if (value > 0) {
                        hasInputs = true;
                        sumPlayers += value;
                    }
                });
                
                const isValid = sumPlayers === baseFields.totalPlayersCount && hasInputs;
                
                return {
                    isValid,
                    sumPlayers,
                    totalPlayersCount: baseFields.totalPlayersCount,
                    missing: baseFields.totalPlayersCount - sumPlayers
                };
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –ø–æ —á–∞—Å–∞–º
            function generateHourFields() {
                const hours = parseNumber(hoursInput.value);
                hoursContainer.innerHTML = '';
                hourInputs = []; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫—ç—à
                hourElements = []; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫—ç—à —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                DOMCache.clearHourInputsCache(); // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ—á–∏—â–µ–Ω–∏–µ –∫—ç—à–∞
                
                if (!hours || hours < CONFIG.CALCULATOR.MIN_HOURS) {
                    updateValidation();
                    return;
                }
                
                for (let h = 1; h <= hours; h++) {
                    const hourDiv = document.createElement('div');
                    hourDiv.className = 'hour-group';
                    hourDiv.setAttribute('role', 'group');
                    hourDiv.setAttribute('aria-label', `${h} —á–∞—Å`);
                    
                    hourDiv.innerHTML = `
                        <div class="hour-header">
                            <div class="hour-title">${h} ${h === 1 ? '—á–∞—Å' : h < 5 ? '—á–∞—Å–∞' : '—á–∞—Å–æ–≤'}</div>
                        </div>
                        <div class="hour-input-group">
                            <div class="hour-input-label">–ò–≥—Ä–æ–∫–æ–≤:</div>
                            <input type="text" 
                                   class="hour-input" 
                                   inputmode="numeric"
                                   pattern="[0-9]*"
                                   placeholder="0"
                                   data-hour="${h}"
                                   aria-label="–ò–≥—Ä–æ–∫–æ–≤ –Ω–∞ ${h} —á–∞—Å">
                        </div>
                    `;
                    
                    hoursContainer.appendChild(hourDiv);
                    hourElements.push(hourDiv);
                    
                    const input = hourDiv.querySelector('.hour-input');
                    hourInputs.push(input);
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ - —Ç–æ–ª—å–∫–æ –æ—á–∏—Å—Ç–∫–∞ –æ—Ç –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                    input.addEventListener('input', function() {
                        // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                        this.value = sanitizeNumericInput(this.value);
                        validateDistributionAndUpdate();
                    });
                    
                    // –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
                    input.addEventListener('blur', function() {
                        const validated = finalizeNumericValue(
                            this.value,
                            0,
                            CONFIG.CALCULATOR.MAX_PLAYERS
                        );
                        if (this.value !== validated) {
                            this.value = validated;
                        }
                        validateDistributionAndUpdate();
                    });
                    
                    // –£–ª—É—á—à–µ–Ω–Ω—ã–π –≤–≤–æ–¥ —á–∏—Å–µ–ª —Å –ø–æ–º–æ—â—å—é —Å—Ç—Ä–µ–ª–æ–∫
                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                            e.preventDefault();
                            const current = parseNumber(this.value);
                            const newValue = e.key === 'ArrowUp' ? current + 1 : Math.max(0, current - 1);
                            this.value = newValue.toString();
                            validateDistributionAndUpdate();
                        }
                    });
                }
                
                updateValidation();
            }
            
            // –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            function validateDistributionAndUpdate() {
                const distribution = validateDistribution();
                updateValidation(distribution);
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            function updateValidation(distribution) {
                distribution = distribution || validateDistribution();
                const baseFields = validateBaseFields();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è
                if (!baseFields.isValid) {
                    DOMUtils.hide(validationMessage);
                    DOMUtils.removeClass(calculateBtn, 'active');
                    calculateBtn.disabled = true;
                    calculateBtn.style.cursor = 'not-allowed';
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É–º–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
                if (distribution.isValid) {
                    DOMUtils.show(validationMessage);
                    DOMUtils.removeClass(validationMessage, 'error');
                    DOMUtils.addClass(validationMessage, 'success');
                    DOMUtils.setHTML(validationMessage, 
                        `<i class="fas fa-check-circle"></i> –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–µ—Ä–Ω—ã! –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–æ: ${distribution.sumPlayers} –∏–∑ ${distribution.totalPlayersCount} –∏–≥—Ä–æ–∫–æ–≤`);
                    
                    DOMUtils.addClass(calculateBtn, 'active');
                    calculateBtn.disabled = false;
                    calculateBtn.style.cursor = 'pointer';
                } else {
                    DOMUtils.show(validationMessage);
                    DOMUtils.removeClass(validationMessage, 'success');
                    DOMUtils.addClass(validationMessage, 'error');
                    
                    if (distribution.sumPlayers === 0) {
                        DOMUtils.setHTML(validationMessage, 
                            `<i class="fas fa-exclamation-circle"></i> –í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Å–∞ –∏–≥—Ä—ã`);
                    } else if (distribution.sumPlayers > distribution.totalPlayersCount) {
                        DOMUtils.setHTML(validationMessage, 
                            `<i class="fas fa-exclamation-circle"></i> –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: ${distribution.sumPlayers} –∏–∑ ${distribution.totalPlayersCount}`);
                    } else {
                        DOMUtils.setHTML(validationMessage, 
                            `<i class="fas fa-exclamation-circle"></i> –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏–≥—Ä–æ–∫–æ–≤: ${distribution.sumPlayers} –∏–∑ ${distribution.totalPlayersCount} (–æ—Å—Ç–∞–ª–æ—Å—å: ${distribution.missing})`);
                    }
                    
                    DOMUtils.removeClass(calculateBtn, 'active');
                    calculateBtn.disabled = true;
                    calculateBtn.style.cursor = 'not-allowed';
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –¥–æ –¥–µ—Å—è—Ç–∫–æ–≤
            function roundToTen(n) {
                return Math.ceil(n / 10) * 10;
            }
            
            // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞
            function calculate() {
                // –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Ä–∞—Å—á–µ—Ç–æ–º
                [hallPrice, hoursInput, totalPlayers].forEach(input => {
                    let min, max;
                    
                    if (input.id === 'hallPrice') {
                        min = CONFIG.CALCULATOR.MIN_HALL_PRICE;
                        max = CONFIG.CALCULATOR.MAX_HALL_PRICE;
                    } else if (input.id === 'hours') {
                        min = CONFIG.CALCULATOR.MIN_HOURS;
                        max = CONFIG.CALCULATOR.MAX_HOURS;
                    } else if (input.id === 'totalPlayers') {
                        min = CONFIG.CALCULATOR.MIN_PLAYERS;
                        max = CONFIG.CALCULATOR.MAX_PLAYERS;
                    }
                    
                    const validated = finalizeNumericValue(input.value, min, max);
                    if (input.value !== validated) {
                        input.value = validated;
                    }
                });
                
                // –¢–∞–∫–∂–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ–º –ø–æ–ª—è —á–∞—Å–æ–≤
                hourInputs.forEach(input => {
                    const validated = finalizeNumericValue(input.value, 0, CONFIG.CALCULATOR.MAX_PLAYERS);
                    if (input.value !== validated) {
                        input.value = validated;
                    }
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ—Å–ª–µ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
                validateDistributionAndUpdate();
                
                const baseFields = validateBaseFields();
                const distribution = validateDistribution();
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è - –ø–æ–ª–∞–≥–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ UI-–≤–∞–ª–∏–¥–∞—Ü–∏—é
                if (!baseFields.isValid || !distribution.isValid) {
                    return;
                }
                
                // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–æ–≤
                const playersByHours = {};
                
                hourInputs.forEach(input => {
                    const value = parseNumber(input.value);
                    if (value > 0) {
                        const hour = parseInt(input.dataset.hour);
                        playersByHours[hour] = value;
                    }
                });
                
                // –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ (–Ω–µ–∏–∑–º–µ–Ω–Ω–∞—è)
                const playersInHour = {};
                for (let h = 1; h <= baseFields.hours; h++) {
                    playersInHour[h] = 0;
                    for (let ph in playersByHours) {
                        if (+ph >= h) {
                            playersInHour[h] += playersByHours[ph];
                        }
                    }
                }
                
                const hourCost = {};
                for (let h = 1; h <= baseFields.hours; h++) {
                    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–µ–ª–µ–Ω–∏–µ –Ω–∞ 0
                    hourCost[h] = playersInHour[h] > 0 ? baseFields.price / playersInHour[h] : 0;
                }
                
                // –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                const results = [];
                const sortedHours = Object.keys(playersByHours).sort((a, b) => a - b);
                
                sortedHours.forEach(h => {
                    let sum = 0;
                    for (let i = 1; i <= h; i++) {
                        sum += hourCost[i];
                    }
                    
                    const roundedSum = roundToTen(sum);
                    
                    results.push({
                        players: playersByHours[h],
                        hours: parseInt(h),
                        costPerPlayer: roundedSum
                    });
                });
                
                // –°–æ–∑–¥–∞–µ–º –æ—Ç—á—ë—Ç
                createReport(baseFields.price, baseFields.hours, baseFields.totalPlayersCount, results);
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞
            function createReport(price, hours, players, results) {
                let report = `üìÖ ${getDateInfo()}\n\n`;
                report += `üèü –û–ü–õ–ê–¢–ê –ó–ê –ó–ê–õ\n\n`;
                report += `üí≥ –û–ø–ª–∞—Ç–∞:\n`;
                report += `${CONFIG.REPORT.BANK_NAME}\n`;
                report += `üìû ${CONFIG.REPORT.PHONE_NUMBER}\n\n`;
                
                report += `üë• –í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: ${players}\n`;
                report += `‚è± –í—Å–µ–≥–æ —á–∞—Å–æ–≤: ${hours}\n\n`;
                
                report += `üìä –†–∞—Å—á—ë—Ç:\n`;
                
                results.sort((a, b) => a.hours - b.hours);
                
                results.forEach(result => {
                    report += `‚ñ´Ô∏è ${result.players} —á–µ–ª ‚Äî ${result.hours} —á ‚Üí ${result.costPerPlayer} ‚ÇΩ\n`;
                });
                
                report += `\n${CONFIG.REPORT.FOOTER_TEXT}`;
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ—Ç—á—ë—Ç —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫
                requestAnimationFrame(() => {
                    DOMUtils.setText(reportBox, report);
                    DOMUtils.show(resultSection);
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å—á–µ—Ç–∞
                    calculateBtn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        calculateBtn.style.transform = 'scale(1)';
                    }, 150);
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏
                    resetTelegramButton();
                    
                    // Telegram Web App
                    if (isTelegramWebApp) {
                        Telegram.WebApp.BackButton.show();
                        
                        Telegram.WebApp.BackButton.onClick(function() {
                            if (DOMCache.get('resultSection').style.display === 'block') {
                                DOMUtils.hide(DOMCache.get('resultSection'));
                                Telegram.WebApp.BackButton.hide();
                            } else {
                                Telegram.WebApp.close();
                            }
                        });
                    }
                    
                    // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
                    resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                });
            }
            
            // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            function copyToClipboard() {
                const reportText = reportBox.textContent;
                
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(reportText).then(() => {
                        showCopySuccess();
                    }).catch(() => {
                        fallbackCopyText(reportText);
                    });
                } else {
                    fallbackCopyText(reportText);
                }
            }
            
            // –†–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            function fallbackCopyText(text) {
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    
                    textArea.focus();
                    textArea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (successful) {
                        showCopySuccess();
                    } else {
                        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å');
                    }
                } catch (err) {
                    showStatusMessage('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é –∏–∑ –ø–æ–ª—è –≤—ã—à–µ', 'error');
                    
                    if (isTelegramWebApp) {
                        Telegram.WebApp.showPopup({
                            title: '–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é',
                            message: '–í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤—ã—à–µ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ',
                            buttons: [{ type: 'ok' }]
                        });
                    }
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
            function showCopySuccess() {
                DOMUtils.addClass(copyBtn, 'success');
                DOMUtils.setHTML(copyBtn, '<i class="fas fa-check"></i> –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
                
                if (isTelegramWebApp) {
                    Telegram.WebApp.showPopup({
                        title: '–£—Å–ø–µ—à–Ω–æ',
                        message: '–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞',
                        buttons: [{ type: 'ok' }]
                    });
                } else {
                    showStatusMessage('‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                }
                
                setTimeout(() => {
                    DOMUtils.removeClass(copyBtn, 'success');
                    DOMUtils.setHTML(copyBtn, '<i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç');
                }, 2000);
            }
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
            async function sendToTelegram() {
                const reportText = reportBox.textContent;
                
                if (!reportText || reportText.trim() === '') {
                    showStatusMessage('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏', 'error');
                    return;
                }
                
                if (!navigator.onLine) {
                    showStatusMessage('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É', 'error');
                    return;
                }
                
                showSendingStatus();
                
                try {
                    const url = `https://api.telegram.org/bot${CONFIG.TELEGRAM.TOKEN}/sendMessage`;
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: CONFIG.TELEGRAM.CHAT_ID,
                            message_thread_id: CONFIG.TELEGRAM.RESULT_THREAD_ID,
                            text: reportText,
                            parse_mode: 'Markdown'
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.ok) {
                        showStatusMessage('‚úÖ –û—Ç—á—ë—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram!', 'success');
                        showSuccessStatus();
                        
                        if (isTelegramWebApp) {
                            Telegram.WebApp.showPopup({
                                title: '–£—Å–ø–µ—à–Ω–æ',
                                message: '–û—Ç—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É',
                                buttons: [{ type: 'ok' }]
                            });
                        }
                        
                        setTimeout(resetTelegramButton, 3000);
                    } else {
                        showStatusMessage(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${data.description || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                        showErrorStatus();
                    }
                    
                } catch (error) {
                    showStatusMessage('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ', 'error');
                    showErrorStatus();
                }
            }
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
            function showSendingStatus() {
                DOMUtils.addClass(telegramBtn, 'sending');
                DOMUtils.setHTML(telegramBtn, '<i class="fas fa-spinner fa-spin"></i> –û—Ç–ø—Ä–∞–≤–∫–∞...');
                telegramBtn.disabled = true;
                DOMUtils.hide(statusMessage);
            }
            
            function showSuccessStatus() {
                DOMUtils.removeClass(telegramBtn, 'sending');
                DOMUtils.addClass(telegramBtn, 'success');
                DOMUtils.setHTML(telegramBtn, '<i class="fas fa-check"></i> –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
                telegramBtn.disabled = false;
            }
            
            function showErrorStatus() {
                DOMUtils.removeClass(telegramBtn, 'sending');
                DOMUtils.addClass(telegramBtn, 'error');
                DOMUtils.setHTML(telegramBtn, '<i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞');
                telegramBtn.disabled = false;
                
                setTimeout(resetTelegramButton, 3000);
            }
            
            function resetTelegramButton() {
                DOMUtils.removeClass(telegramBtn, 'sending', 'success', 'error');
                DOMUtils.setHTML(telegramBtn, '<i class="fab fa-telegram"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram');
                telegramBtn.disabled = false;
                DOMUtils.hide(statusMessage);
            }
            
            function showStatusMessage(message, type = 'info') {
                DOMUtils.setText(statusMessage, message);
                DOMUtils.removeClass(statusMessage, 'success', 'error');
                DOMUtils.addClass(statusMessage, type);
                DOMUtils.show(statusMessage);
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª–µ–π
            function setupBaseFieldHandlers() {
                const debouncedUpdate = debounce(() => {
                    updateTotalCostPreview();
                    updateValidation();
                }, 300);
                
                // –î–µ–±–∞—É–Ω—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª–µ–π —á–∞—Å–æ–≤ (—á—Ç–æ–±—ã –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤–≤–æ–¥–µ —Å–∏–º–≤–æ–ª–∞)
                const debouncedGenerateHourFields = debounce(generateHourFields, 300);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª–µ–π - –ú–Ø–ì–ö–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø
                [hallPrice, totalPlayers].forEach(input => {
                    // –ü—Ä–∏ –≤–≤–æ–¥–µ - —Ç–æ–ª—å–∫–æ –æ—á–∏—Å—Ç–∫–∞ –æ—Ç –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                    input.addEventListener('input', function() {
                        // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                        this.value = sanitizeNumericInput(this.value);
                        updateTotalCostPreview();
                        debouncedUpdate();
                    });
                    
                    // –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
                    input.addEventListener('blur', function() {
                        let min, max;
                        
                        if (this.id === 'hallPrice') {
                            min = CONFIG.CALCULATOR.MIN_HALL_PRICE;
                            max = CONFIG.CALCULATOR.MAX_HALL_PRICE;
                        } else if (this.id === 'totalPlayers') {
                            min = CONFIG.CALCULATOR.MIN_PLAYERS;
                            max = CONFIG.CALCULATOR.MAX_PLAYERS;
                        }
                        
                        const validated = finalizeNumericValue(this.value, min, max);
                        if (this.value !== validated) {
                            this.value = validated;
                        }
                        updateTotalCostPreview();
                        updateValidation();
                    });
                });
                
                // –û—Å–æ–±—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–∞—Å–æ–≤ - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª—è —Å—Ä–∞–∑—É –ø—Ä–∏ –≤–≤–æ–¥–µ
                hoursInput.addEventListener('input', function() {
                    // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                    this.value = sanitizeNumericInput(this.value);
                    updateTotalCostPreview();
                    
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª—è —á–∞—Å–æ–≤ —Å –¥–µ–±–∞—É–Ω—Å–æ–º
                    debouncedGenerateHourFields();
                    debouncedUpdate();
                });
                
                // –¢–∞–∫–∂–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
                hoursInput.addEventListener('blur', function() {
                    const validated = finalizeNumericValue(
                        this.value, 
                        CONFIG.CALCULATOR.MIN_HOURS, 
                        CONFIG.CALCULATOR.MAX_HOURS
                    );
                    if (this.value !== validated) {
                        this.value = validated;
                    }
                    updateTotalCostPreview();
                    
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª—è —á–∞—Å–æ–≤ (–±–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏)
                    generateHourFields();
                });
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            function init() {
                setupBaseFieldHandlers();
                generateHourFields(); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –µ—Å–ª–∏ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                calculateBtn.addEventListener('click', calculate);
                copyBtn.addEventListener('click', copyToClipboard);
                telegramBtn.addEventListener('click', sendToTelegram);
                
                // –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ iOS
                let focusedElement = null;
                let scrollTimeout = null;
                
                document.addEventListener('focusin', function(e) {
                    if (e.target.tagName === 'INPUT') {
                        focusedElement = e.target;
                        
                        clearTimeout(scrollTimeout);
                        scrollTimeout = setTimeout(() => {
                            if (focusedElement === e.target) {
                                e.target.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center',
                                    inline: 'center'
                                });
                            }
                        }, 300);
                    }
                });
                
                document.addEventListener('focusout', function() {
                    clearTimeout(scrollTimeout);
                    focusedElement = null;
                });
            }
            
            // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            init();
        });
    </script>
</body>
</html>
