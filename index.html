
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–†–∞—Å—á—ë—Ç –æ–ø–ª–∞—Ç—ã</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body { font-family: Arial; padding: 16px; }
input { width: 100%; padding: 8px; margin-bottom: 10px; }

button {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-top: 10px;
}

button:disabled {
  background: #ccc;
  color: #666;
}

button.active {
  background: #2ecc71;
  color: white;
}

.clear {
  background: #e74c3c;
  color: white;
}
</style>
</head>

<body>
<h3 id="date"></h3>

<input id="price" type="number" placeholder="üíµ –¶–µ–Ω–∞ –∑–∞–ª–∞ –∑–∞ 1 —á–∞—Å (700‚Äì10000)">
<input id="hours" type="number" placeholder="üïë –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ (1‚Äì24)">
<input id="players" type="number" placeholder="üë• –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ (6‚Äì50)">

<h4>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤</h4>
<div id="distribution"></div>

<button id="previewBtn" disabled onclick="preview()">üëÄ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
<button class="clear" onclick="clearAll()">üóë –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

<script>
console.log(window.Telegram);
alert(window.Telegram ? 'WebApp OK' : 'NO WebApp');
const tg = window.Telegram.WebApp;
tg.expand();

/* üìÖ –¥–∞—Ç–∞ */
const d = new Date();
const days = ['–í–û–°–ö–†–ï–°–ï–ù–¨–ï','–ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö','–í–¢–û–†–ù–ò–ö','–°–†–ï–î–ê','–ß–ï–¢–í–ï–†–ì','–ü–Ø–¢–ù–ò–¶–ê','–°–£–ë–ë–û–¢–ê'];
document.getElementById('date').innerText =
  `üìÖ ${days[d.getDay()]} ${d.toLocaleDateString('ru-RU')}`;

document.getElementById('hours').addEventListener('input', renderHours);
document.querySelectorAll('input').forEach(i =>
  i.addEventListener('input', validate)
);

function renderHours() {
  const hours = Number(hoursInput.value);
  const div = document.getElementById('distribution');
  div.innerHTML = '';

  for (let h = 1; h <= hours; h++) {
    div.innerHTML += `
      <input type="number"
        placeholder="${h} —á–∞—Å(–∞) ‚Äî —Å–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫"
        id="h${h}">
    `;
  }

  document.querySelectorAll('#distribution input')
    .forEach(i => i.addEventListener('input', validate));
}

function validate() {
  const price = Number(priceInput.value);
  const hours = Number(hoursInput.value);
  const players = Number(playersInput.value);

  if (price < 700 || price > 10000) return disable();
  if (hours < 1 || hours > 24) return disable();
  if (players < 6 || players > 50) return disable();

  let sum = 0;
  for (let h = 1; h <= hours; h++) {
    sum += Number(document.getElementById('h'+h)?.value || 0);
  }

  if (sum !== players) return disable();

  enable();
}

function enable() {
  previewBtn.disabled = false;
  previewBtn.classList.add('active');
}

function disable() {
  previewBtn.disabled = true;
  previewBtn.classList.remove('active');
}

function preview() {
  const data = {
    hallPrice: Number(priceInput.value),
    totalHours: Number(hoursInput.value),
    totalPlayers: Number(playersInput.value),
    playersByHours: {}
  };

  for (let h = 1; h <= data.totalHours; h++) {
    const v = Number(document.getElementById('h'+h).value || 0);
    if (v > 0) data.playersByHours[h] = v;
  }

  tg.sendData(JSON.stringify(data));
}

function clearAll() {
  document.querySelectorAll('input').forEach(i => i.value = '');
  document.getElementById('distribution').innerHTML = '';
  disable();
}

/* —É–¥–æ–±–Ω—ã–µ —Å—Å—ã–ª–∫–∏ */
const priceInput = document.getElementById('price');
const hoursInput = document.getElementById('hours');
const playersInput = document.getElementById('players');
const previewBtn = document.getElementById('previewBtn');
</script>
</body>
</html>