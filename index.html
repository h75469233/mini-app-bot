<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ß–∞—Ä–∫—É–ª—è—Ç–æ—Ä</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            min-height: 100vh;
            padding: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            -webkit-text-size-adjust: 100%;
            touch-action: pan-y;
        }
        
        /* –°—Ç–∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–∞ */
        .access-denied-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 500px;
            padding: 40px;
            text-align: center;
            animation: slideUp 0.4s ease;
        }
        
        .access-denied-icon {
            font-size: 70px;
            color: #e74c3c;
            margin-bottom: 20px;
        }
        
        .access-denied-title {
            color: #333;
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .access-denied-message {
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .access-denied-btn {
            background: #1a2980;
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .access-denied-btn:hover {
            background: #162470;
            transform: translateY(-2px);
        }
        
        /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω */
        .loading-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 500px;
            padding: 40px;
            text-align: center;
            animation: slideUp 0.4s ease;
        }
        
        .loading-spinner {
            font-size: 50px;
            color: #1a2980;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #333;
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .loading-subtext {
            color: #666;
            font-size: 14px;
        }
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 700px;
            padding: 25px;
            animation: slideUp 0.4s ease;
            display: none; /* –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã—Ç */
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                border-radius: 15px;
                margin: 10px;
            }
            
            body {
                padding: 10px;
                align-items: flex-start;
                min-height: 100vh;
            }
            
            .access-denied-container,
            .loading-container {
                padding: 25px;
                margin: 10px;
            }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #eaeaea;
            padding-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .header {
                margin-bottom: 15px;
                padding-bottom: 10px;
            }
        }
        
        .header h1 {
            color: #1a2980;
            font-size: 26px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .date-display {
            color: #666;
            font-size: 14px;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .main-date {
            color: #1a2980;
            font-size: 24px;
            font-weight: 700;
            margin: 0;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 22px;
            }
            
            .main-date {
                font-size: 20px;
            }
        }
        
        .input-section {
            margin-bottom: 20px;
        }
        
        .basic-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .basic-inputs {
                grid-template-columns: 1fr;
                gap: 10px;
                margin-bottom: 15px;
            }
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .input-group {
                margin-bottom: 10px;
            }
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #1a2980;
        }
        
        .input-with-icon input {
            width: 100%;
            padding: 14px 14px 14px 45px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        @media (max-width: 768px) {
            .input-with-icon input {
                padding: 12px 12px 12px 45px;
                font-size: 15px;
            }
        }
        
        .input-with-icon input:focus {
            border-color: #1a2980;
            box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.1);
            outline: none;
        }
        
        .players-section {
            margin-top: 25px;
        }
        
        @media (max-width: 768px) {
            .players-section {
                margin-top: 15px;
            }
        }
        
        .section-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .section-title {
                font-size: 16px;
                margin-bottom: 10px;
            }
        }
        
        .hours-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .hours-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
        }
        
        .hour-group {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }
        
        @media (max-width: 768px) {
            .hour-group {
                padding: 15px;
            }
        }
        
        .hour-group:hover {
            border-color: #1a2980;
            transform: translateY(-2px);
        }
        
        .hour-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .hour-title {
            font-weight: 700;
            color: #1a2980;
            font-size: 16px;
        }
        
        @media (max-width: 768px) {
            .hour-title {
                font-size: 14px;
            }
        }
        
        .hour-input-group {
            margin-bottom: 10px;
        }
        
        .hour-input-label {
            display: block;
            color: #555;
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: 500;
            text-align: center;
        }
        
        .hour-input {
            width: 100%;
            text-align: center;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        @media (max-width: 768px) {
            .hour-input {
                padding: 8px;
                font-size: 15px;
            }
        }
        
        .hour-input:focus {
            border-color: #1a2980;
            outline: none;
        }
        
        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: not-allowed;
            transition: all 0.3s;
            margin-top: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        @media (max-width: 768px) {
            .calculate-btn {
                padding: 16px;
                font-size: 16px;
                margin-top: 20px;
            }
        }
        
        .calculate-btn.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            cursor: pointer;
        }
        
        .calculate-btn.active:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }
        
        .result-section {
            margin-top: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @media (max-width: 768px) {
            .result-section {
                margin-top: 20px;
                padding: 15px;
                border-radius: 12px;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .result-header {
                font-size: 18px;
                margin-bottom: 15px;
            }
        }
        
        .report-box {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 4px solid #26d0ce;
            white-space: pre-line;
            line-height: 1.6;
            font-size: 16px;
        }
        
        @media (max-width: 768px) {
            .report-box {
                padding: 15px;
                font-size: 15px;
                line-height: 1.5;
            }
        }
        
        .footer {
            text-align: center;
            margin-top: 25px;
            color: #666;
            font-size: 13px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .footer {
                margin-top: 15px;
                padding-top: 15px;
                font-size: 12px;
            }
        }
        
        /* –ò–ó–ú–ï–ù–ï–ù –¶–í–ï–¢ –ö–ù–û–ü–ö–ò –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø - –æ—Ä–∞–Ω–∂–µ–≤—ã–π/–∂–µ–ª—Ç—ã–π */
        .copy-btn {
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        @media (max-width: 768px) {
            .copy-btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
        
        .copy-btn:hover {
            background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }
        
        .copy-btn.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }
        
        /* –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram */
        .telegram-btn {
            background: linear-gradient(135deg, #0088cc 0%, #1e96c8 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            margin-left: 10px;
        }
        
        @media (max-width: 768px) {
            .telegram-btn {
                padding: 10px 20px;
                font-size: 14px;
                margin-left: 0;
                margin-top: 10px;
            }
        }
        
        .telegram-btn:hover {
            background: linear-gradient(135deg, #0077b5 0%, #1a87b5 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
        }
        
        .telegram-btn.sending {
            background: #7f8c8d;
            cursor: not-allowed;
        }
        
        .telegram-btn.success {
            background: #27ae60;
        }
        
        .telegram-btn.error {
            background: #e74c3c;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 25px;
        }
        
        @media (max-width: 768px) {
            .actions {
                margin-top: 15px;
                flex-direction: column;
                align-items: center;
            }
        }
        
        .validation-message {
            background: #fff8e1;
            border-radius: 10px;
            padding: 12px 15px;
            margin: 15px 0;
            border-left: 4px solid #ffb300;
            font-size: 14px;
            display: none;
        }
        
        @media (max-width: 768px) {
            .validation-message {
                padding: 10px 12px;
                margin: 10px 0;
                font-size: 13px;
            }
        }
        
        .validation-message.error {
            background: #ffebee;
            border-left-color: #e74c3c;
        }
        
        .validation-message.success {
            background: #e8f5e9;
            border-left-color: #27ae60;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        .status-message {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 12px 15px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
            font-size: 14px;
            display: none;
            text-align: center;
            animation: fadeIn 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .status-message {
                padding: 10px 12px;
                margin: 10px 0;
                font-size: 13px;
            }
        }
        
        .status-message.success {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }
        
        .status-message.error {
            background: #ffebee;
            border-left-color: #f44336;
        }
        
        /* –£–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 400px) {
            .hours-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .hour-group {
                padding: 12px;
            }
            
            .hour-title {
                font-size: 13px;
            }
            
            .hour-input {
                padding: 6px;
                font-size: 14px;
            }
        }
        
        /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ zoom –Ω–∞ iOS –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
        @media screen and (max-width: 768px) {
            input, textarea, select {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingContainer" class="loading-container" style="display: block;">
        <div class="loading-spinner">
            <i class="fas fa-spinner"></i>
        </div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</div>
        <div class="loading-subtext">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Ç–∫–∞–∑–µ –≤ –¥–æ—Å—Ç—É–ø–µ -->
    <div id="accessDeniedContainer" class="access-denied-container" style="display: none;">
        <div class="access-denied-icon">
            <i class="fas fa-ban"></i>
        </div>
        <h2 class="access-denied-title">üö´ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h2>
        <p class="access-denied-message" id="accessDeniedMessage">
            –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.
        </p>
        <button class="access-denied-btn" id="closeAppBtn">
            <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        </button>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div class="container" id="mainContainer">
        <div class="header">
            <div class="main-date" id="currentDate"></div>
        </div>
        
        <div class="input-section">
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –≤–≤–æ–¥—ã -->
            <div class="basic-inputs">
                <div class="input-group">
                    <label><i class="fas fa-money-bill-wave"></i> –¶–µ–Ω–∞ –∑–∞–ª–∞ –∑–∞ 1 —á–∞—Å (‚ÇΩ)</label>
                    <div class="input-with-icon">
                        <i class="fas fa-ruble-sign"></i>
                        <input type="number" id="hallPrice" min="700" max="10000" step="100" placeholder="700-10000">
                    </div>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-clock"></i>–ß–∞—Å–æ–≤ –∞—Ä–µ–Ω–¥—ã –∑–∞–ª–∞</label>
                    <div class="input-with-icon">
                        <i class="fas fa-clock"></i>
                        <input type="number" id="hours" min="1" max="24" placeholder="1-24">
                    </div>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-users"></i> –í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user"></i>
                        <input type="number" id="totalPlayers" min="1" max="35" placeholder="1-35">
                    </div>
                </div>
            </div>
            
            <div class="validation-message" id="validationMessage"></div>
            
            <!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —á–∞—Å–∞–º -->
            <div class="players-section">
                <div class="section-title">
                    <i class="fas fa-user-clock"></i> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —á–∞—Å–∞–º
                </div>
                
                <div class="hours-grid" id="hoursContainer">
                    <!-- –ß–∞—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
        
        <button class="calculate-btn" id="calculateBtn">
            <i class="fas fa-calculator"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
        </button>
        
        <div class="result-section" id="resultSection">
            <div class="result-header">
                <i class="fas fa-file-invoice-dollar"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–∞
            </div>
            
            <div class="report-box" id="reportBox">
                <!-- –û—Ç—á—ë—Ç –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω —Å—é–¥–∞ -->
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
            <div class="status-message" id="statusMessage"></div>
            
            <div class="actions">
                <button class="copy-btn" id="copyBtn">
                    <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </button>
                <button class="telegram-btn" id="telegramBtn">
                    <i class="fab fa-telegram"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
                </button>
            </div>
        </div>
        
        <div class="footer">
            <!-- –§—É—Ç–µ—Ä –æ—Å—Ç–∞–≤–ª–µ–Ω –ø—É—Å—Ç—ã–º –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É -->
        </div>
    </div>
    
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram
        const TOKEN = '8554439488:AAGAK-D2Q59YznAiN5Tt7F7dUMLAsWpjmdc';
        const CHAT_ID = -1003677318941;
        const RESULT_THREAD_ID = 8;
        
        // –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        const ALLOWED_USER_IDS = [
            1157942871, // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 1
            5256755259  // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 2
        ];
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –≤ Telegram Web App
        function isTelegramWebApp() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—ä–µ–∫—Ç–∞ Telegram
            if (typeof window.Telegram !== 'undefined' && 
                typeof window.Telegram.WebApp !== 'undefined') {
                return true;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º (Telegram Web App –¥–æ–±–∞–≤–ª—è–µ—Ç –∏—Ö)
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('tgWebAppData') || urlParams.has('tgWebAppVersion')) {
                return true;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ —Ö—ç—à—É (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±)
            if (window.location.hash.includes('tgWebApp')) {
                return true;
            }
            
            return false;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ Telegram Web App
            function check() {
                attempts++;
                
                if (typeof window.Telegram !== 'undefined' && 
                    typeof window.Telegram.WebApp !== 'undefined') {
                    // Telegram Web App –∑–∞–≥—Ä—É–∂–µ–Ω
                    callback(true);
                    return;
                }
                
                if (attempts >= maxAttempts) {
                    // –ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
                    callback(false);
                    return;
                }
                
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å
                setTimeout(check, interval);
            }
            
            check();
        
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
        function checkAccess() {
    if (!window.Telegram || !Telegram.WebApp) {
        showAccessDenied(
            "–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞"
        );
        return Promise.resolve(false);
    }

    try {
        Telegram.WebApp.ready();

        const user = Telegram.WebApp.initDataUnsafe?.user;

        if (!user || !user.id) {
            showAccessDenied(
                "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
            );
            return Promise.resolve(false);
        }

        if (!ALLOWED_USER_IDS.includes(user.id)) {
            showAccessDenied(
                `ID: ${user.id}<br>–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞`
            );
            return Promise.resolve(false);
        }

        return Promise.resolve(true);

    } catch (e) {
        console.error(e);
        showAccessDenied(
            "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram Web App"
        );
        return Promise.resolve(false);
    }
}
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—Ç–∫–∞–∑–∞ –≤ –¥–æ—Å—Ç—É–ø–µ
        function showAccessDenied(message) {
            hideLoading();
            document.getElementById('accessDeniedMessage').innerHTML = message;
            document.getElementById('accessDeniedContainer').style.display = 'block';
            document.getElementById('mainContainer').style.display = 'none';
            
            // –í Telegram Web App –æ—Ç–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
            if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                try {
                    Telegram.WebApp.disableClosingConfirmation();
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è:", e);
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è —ç–∫—Ä–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        function hideLoading() {
            document.getElementById('loadingContainer').style.display = 'none';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function showMainApp() {
            hideLoading();
            document.getElementById('accessDeniedContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Web App
            if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                try {
                    Telegram.WebApp.ready();
                    Telegram.WebApp.expand();
                    Telegram.WebApp.setHeaderColor('#1a2980');
                    Telegram.WebApp.setBackgroundColor('#f8f9fa');
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
                    Telegram.WebApp.BackButton.onClick(function() {
                        if (document.getElementById('resultSection').style.display === 'block') {
                            document.getElementById('resultSection').style.display = 'none';
                            Telegram.WebApp.BackButton.hide();
                        } else {
                            Telegram.WebApp.close();
                        }
                    });
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram Web App:", e);
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            initMainApp();
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–∞");
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø
            checkAccess().then((accessGranted) => {
                if (accessGranted) {
                    showMainApp();
                }
            }).catch((error) => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞:", error);
                showAccessDenied("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞.");
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            document.getElementById('closeAppBtn').addEventListener('click', function() {
                if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                    try {
                        Telegram.WebApp.close();
                    } catch (e) {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:", e);
                        hideAccessDenied();
                    }
                } else {
                    // –ï—Å–ª–∏ –Ω–µ –≤ Telegram, –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    hideAccessDenied();
                }
            });
        });
        
        // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Ç–∫–∞–∑–µ –≤ –¥–æ—Å—Ç—É–ø–µ
        function hideAccessDenied() {
            document.getElementById('accessDeniedContainer').style.display = 'none';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initMainApp() {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è");
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            function getDateInfo() {
                const now = new Date();
                const days = ['–í–û–°–ö–†–ï–°–ï–ù–¨–ï', '–ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö', '–í–¢–û–†–ù–ò–ö', '–°–†–ï–î–ê', '–ß–ï–¢–í–ï–†–ì', '–ü–Ø–¢–ù–ò–¶–ê', '–°–£–ë–ë–û–¢–ê'];
                const dayOfWeek = days[now.getDay()];
                
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = now.getFullYear();
                
                return `${dayOfWeek} ${day}.${month}.${year}`;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            document.getElementById('currentDate').textContent = getDateInfo();
            
            // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
            const hallPrice = document.getElementById('hallPrice');
            const hoursInput = document.getElementById('hours');
            const totalPlayers = document.getElementById('totalPlayers');
            const hoursContainer = document.getElementById('hoursContainer');
            const calculateBtn = document.getElementById('calculateBtn');
            const resultSection = document.getElementById('resultSection');
            const reportBox = document.getElementById('reportBox');
            const copyBtn = document.getElementById('copyBtn');
            const telegramBtn = document.getElementById('telegramBtn');
            const validationMessage = document.getElementById('validationMessage');
            const statusMessage = document.getElementById('statusMessage');
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –ø–æ —á–∞—Å–∞–º
            function generateHourFields() {
                const hours = Number(hoursInput.value);
                hoursContainer.innerHTML = '';
                
                if (!hours || hours < 1) {
                    updateValidation();
                    return;
                }
                
                for (let h = 1; h <= hours; h++) {
                    const hourDiv = document.createElement('div');
                    hourDiv.className = 'hour-group';
                    
                    hourDiv.innerHTML = `
                        <div class="hour-header">
                            <div class="hour-title">${h} ${h === 1 ? '—á–∞—Å' : h < 5 ? '—á–∞—Å–∞' : '—á–∞—Å–æ–≤'}</div>
                        </div>
                        <div class="hour-input-group">
                            <div class="hour-input-label">–ò–≥—Ä–æ–∫–æ–≤:</div>
                            <input type="number" class="hour-input" 
                                   min="0" 
                                   placeholder="0"
                                   data-hour="${h}">
                        </div>
                    `;
                    
                    hoursContainer.appendChild(hourDiv);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –Ω–æ–≤—ã–µ –ø–æ–ª—è
                const hourInputs = document.querySelectorAll('.hour-input');
                hourInputs.forEach(input => {
                    input.addEventListener('input', updateValidation);
                    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ iOS
                    input.addEventListener('touchstart', function(e) {
                        e.stopPropagation();
                    });
                });
                
                updateValidation();
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            function updateValidation() {
                const price = Number(hallPrice.value);
                const hours = Number(hoursInput.value);
                const totalPlayersCount = Number(totalPlayers.value);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
                if (!price || price < 700 || price > 10000 || 
                    !hours || hours < 1 || hours > 24 || 
                    !totalPlayersCount || totalPlayersCount < 1 || totalPlayersCount > 35) {
                    
                    validationMessage.style.display = 'none';
                    calculateBtn.classList.remove('active');
                    calculateBtn.disabled = true;
                    return;
                }
                
                // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–æ–≤
                const inputs = document.querySelectorAll('#hoursContainer input');
                let sumPlayers = 0;
                let hasInputs = false;
                
                inputs.forEach(input => {
                    const value = Number(input.value || 0);
                    if (value > 0) {
                        hasInputs = true;
                        sumPlayers += value;
                    }
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É–º–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
                if (sumPlayers === totalPlayersCount && hasInputs) {
                    validationMessage.style.display = 'block';
                    validationMessage.className = 'validation-message success';
                    validationMessage.innerHTML = `‚úì –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–µ—Ä–Ω—ã! –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–æ: ${sumPlayers} –∏–∑ ${totalPlayersCount} –∏–≥—Ä–æ–∫–æ–≤`;
                    
                    calculateBtn.classList.add('active');
                    calculateBtn.disabled = false;
                } else {
                    validationMessage.style.display = 'block';
                    validationMessage.className = 'validation-message error';
                    
                    if (sumPlayers === 0) {
                        validationMessage.innerHTML = `‚úó –í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Å–∞ –∏–≥—Ä—ã`;
                    } else {
                        validationMessage.innerHTML = `‚úó –°—É–º–º–∞ –ø–æ —á–∞—Å–∞–º (${sumPlayers}) –Ω–µ —Ä–∞–≤–Ω–∞ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏–≥—Ä–æ–∫–æ–≤ (${totalPlayersCount})`;
                    }
                    
                    calculateBtn.classList.remove('active');
                    calculateBtn.disabled = true;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —á–∏—Å–ª–∞
            function isValidNumber(v, min, max) {
                return !isNaN(v) && v >= min && v <= max;
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –¥–æ –¥–µ—Å—è—Ç–∫–æ–≤
            function roundToTen(n) {
                return Math.ceil(n / 10) * 10;
            }
            
            // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞
            function calculate() {
                const price = Number(hallPrice.value);
                const hours = Number(hoursInput.value);
                const totalPlayersCount = Number(totalPlayers.value);
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
                if (!isValidNumber(price, 100, 50000)) {
                    alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞–ª–∞ (–æ—Ç 100 –¥–æ 50000)');
                    return;
                }
                if (!isValidNumber(hours, 1, 24)) {
                    alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ (–æ—Ç 1 –¥–æ 24)');
                    return;
                }
                if (!isValidNumber(totalPlayersCount, 1, 50)) {
                    alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ (–æ—Ç 1 –¥–æ 50)');
                    return;
                }
                
                // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–æ–≤
                const inputs = document.querySelectorAll('#hoursContainer input');
                const playersByHours = {};
                let sumPlayers = 0;
                
                inputs.forEach(input => {
                    const value = Number(input.value || 0);
                    if (value > 0) {
                        const hour = Number(input.dataset.hour);
                        playersByHours[hour] = value;
                        sumPlayers += value;
                    }
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—É–º–º–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏–≥—Ä–æ–∫–æ–≤
                if (sumPlayers !== totalPlayersCount) {
                    alert(`–°—É–º–º–∞ –ø–æ —á–∞—Å–∞–º (${sumPlayers}) –Ω–µ —Ä–∞–≤–Ω–∞ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏–≥—Ä–æ–∫–æ–≤ (${totalPlayersCount})`);
                    return;
                }
                
                // –õ–û–ì–ò–ö–ê –†–ê–°–ß–ï–¢–ê (–Ω–µ–∏–∑–º–µ–Ω–Ω–∞—è)
                const playersInHour = {};
                for (let h = 1; h <= hours; h++) {
                    playersInHour[h] = 0;
                    for (let ph in playersByHours) {
                        if (+ph >= h) {
                            playersInHour[h] += playersByHours[ph];
                        }
                    }
                }
                
                const hourCost = {};
                for (let h = 1; h <= hours; h++) {
                    hourCost[h] = price / playersInHour[h];
                }
                
                // –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                const results = [];
                const sortedHours = Object.keys(playersByHours).sort((a, b) => a - b);
                
                sortedHours.forEach(h => {
                    let sum = 0;
                    for (let i = 1; i <= h; i++) {
                        sum += hourCost[i];
                    }
                    
                    const roundedSum = roundToTen(sum);
                    
                    results.push({
                        players: playersByHours[h],
                        hours: parseInt(h),
                        costPerPlayer: roundedSum
                    });
                });
                
                // –°–æ–∑–¥–∞–µ–º –æ—Ç—á—ë—Ç –≤ –Ω—É–∂–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                createReport(price, hours, totalPlayersCount, results);
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ –≤ –Ω—É–∂–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            function createReport(price, hours, players, results) {
                let report = `üìÖ ${getDateInfo()}\n\n`;
                report += `üèü –û–ü–õ–ê–¢–ê –ó–ê –ó–ê–õ\n\n`;
                report += `üí≥ –û–ø–ª–∞—Ç–∞:\n`;
                report += `–°–ë–ï–†–ë–ê–ù–ö / –¢–ò–ù–¨–ö–û–í\n`;
                report += `üìû +79264478622 –ê–Ω–∞—Å—Ç–∞—Å–∏—è –°\n\n`;
                
                report += `üë• –í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: ${players}\n`;
                report += `‚è± –í—Å–µ–≥–æ —á–∞—Å–æ–≤: ${hours}\n\n`;
                
                report += `üìä –†–∞—Å—á—ë—Ç:\n`;
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —á–∞—Å–æ–≤ (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é)
                results.sort((a, b) => a.hours - b.hours);
                
                results.forEach(result => {
                    report += `‚ñ´Ô∏è ${result.players} —á–µ–ª ‚Äî ${result.hours} —á ‚Üí ${result.costPerPlayer} ‚ÇΩ\n`;
                });
                
                report += `\n‚ú® –•–≤–æ—Å—Ç–∏–∫–∏ –∏ –±–æ–Ω—É—Å—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è!\n`;
                report += `‚òïÔ∏è –ü–æ–∫—É–ø–∞–µ–º —Å–ø–æ—Ä—Ç–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, —á–∞–π –∏ –∫–æ—Ñ–µ\n`;
                report += `üôè –í—Å–µ–º —Å–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É!`;
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ—Ç—á—ë—Ç
                reportBox.textContent = report;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                resultSection.style.display = 'block';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏
                resetTelegramButton();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –≤ Telegram Web App –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                    Telegram.WebApp.BackButton.show();
                }
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
                resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            function copyToClipboard() {
                const reportText = reportBox.textContent;
                
                // –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –±—Ä–∞—É–∑–µ—Ä–æ–≤)
                if (navigator.clipboard && window.isSecureContext) {
                    // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (HTTPS –∏–ª–∏ localhost)
                    navigator.clipboard.writeText(reportText).then(() => {
                        showCopySuccess();
                    }).catch(err => {
                        // –ï—Å–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –ø—Ä–æ–±—É–µ–º —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥
                        fallbackCopyText(reportText);
                    });
                } else {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
                    fallbackCopyText(reportText);
                }
            }
            
            // –†–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ)
            function fallbackCopyText(text) {
                try {
                    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π textarea
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    
                    // –í—ã–¥–µ–ª—è–µ–º –∏ –∫–æ–ø–∏—Ä—É–µ–º
                    textArea.focus();
                    textArea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (successful) {
                        showCopySuccess();
                    } else {
                        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å');
                    }
                } catch (err) {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
                    showStatusMessage('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é –∏–∑ –ø–æ–ª—è –≤—ã—à–µ', 'error');
                    
                    // –í Telegram Web App –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                        Telegram.WebApp.showPopup({
                            title: '–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é',
                            message: '–í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤—ã—à–µ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ',
                            buttons: [{ type: 'ok' }]
                        });
                    }
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
            function showCopySuccess() {
                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                copyBtn.classList.add('success');
                copyBtn.innerHTML = '<i class="fas fa-check"></i> –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                
                // –í Telegram Web App –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                    Telegram.WebApp.showPopup({
                        title: '–£—Å–ø–µ—à–Ω–æ',
                        message: '–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞',
                        buttons: [{ type: 'ok' }]
                    });
                } else {
                    showStatusMessage('‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                }
                
                setTimeout(() => {
                    copyBtn.classList.remove('success');
                    copyBtn.innerHTML = '<i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
                }, 2000);
            }
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
            async function sendToTelegram() {
                const reportText = reportBox.textContent;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Ç—á—ë—Ç–∞
                if (!reportText || reportText.trim() === '') {
                    showStatusMessage('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏', 'error');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
                if (!navigator.onLine) {
                    showStatusMessage('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É', 'error');
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏
                showSendingStatus();
                
                try {
                    // –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram Bot API
                    const url = `https://api.telegram.org/bot${TOKEN}/sendMessage`;
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: CHAT_ID,
                            message_thread_id: RESULT_THREAD_ID,
                            text: reportText,
                            parse_mode: 'Markdown'
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.ok) {
                        showStatusMessage('‚úÖ –û—Ç—á—ë—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram!', 'success');
                        showSuccessStatus();
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram Web App
                        if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                            Telegram.WebApp.showPopup({
                                title: '–£—Å–ø–µ—à–Ω–æ',
                                message: '–û—Ç—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É',
                                buttons: [{ type: 'ok' }]
                            });
                        }
                        
                        // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –≤–∏–¥ –∫–Ω–æ–ø–∫–∏
                        setTimeout(resetTelegramButton, 3000);
                    } else {
                        console.error('–û—à–∏–±–∫–∞ Telegram API:', data);
                        showStatusMessage(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${data.description || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                        showErrorStatus();
                    }
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
                    showStatusMessage('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ', 'error');
                    showErrorStatus();
                }
            }
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
            function showSendingStatus() {
                telegramBtn.classList.add('sending');
                telegramBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û—Ç–ø—Ä–∞–≤–∫–∞...';
                telegramBtn.disabled = true;
                statusMessage.style.display = 'none';
            }
            
            function showSuccessStatus() {
                telegramBtn.classList.remove('sending');
                telegramBtn.classList.add('success');
                telegramBtn.innerHTML = '<i class="fas fa-check"></i> –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
                telegramBtn.disabled = false;
            }
            
            function showErrorStatus() {
                telegramBtn.classList.remove('sending');
                telegramBtn.classList.add('error');
                telegramBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞';
                telegramBtn.disabled = false;
                
                // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –≤–∏–¥
                setTimeout(resetTelegramButton, 3000);
            }
            
            function resetTelegramButton() {
                telegramBtn.classList.remove('sending', 'success', 'error');
                telegramBtn.innerHTML = '<i class="fab fa-telegram"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram';
                telegramBtn.disabled = false;
                statusMessage.style.display = 'none';
            }
            
            function showStatusMessage(message, type = 'info') {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message ' + type;
                statusMessage.style.display = 'block';
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            hoursInput.addEventListener('input', generateHourFields);
            hallPrice.addEventListener('input', updateValidation);
            totalPlayers.addEventListener('input', updateValidation);
            
            calculateBtn.addEventListener('click', calculate);
            copyBtn.addEventListener('click', copyToClipboard);
            telegramBtn.addEventListener('click', sendToTelegram);
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(e) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, { passive: false });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ - –í–°–ï –ü–û–õ–Ø –ü–£–°–¢–´–ï
            generateHourFields();
            
            // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–º–µ—Ä–∞ –º–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:
            /*
            setTimeout(() => {
                // –ü—Ä–∏–º–µ—Ä –∏–∑ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                hallPrice.value = "1500";
                hoursInput.value = "5";
                totalPlayers.value = "19";
                generateHourFields();
                
                // –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö: —É–∫–∞–∑—ã–≤–∞–µ–º —Å–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ —Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –∏–≥—Ä–∞–ª–∏
                const inputs = document.querySelectorAll('#hoursContainer input');
                if (inputs[1]) inputs[1].value = 1;   // 2 —á–∞—Å–∞
                if (inputs[3]) inputs[3].value = 10;  // 4 —á–∞—Å–∞
                if (inputs[4]) inputs[4].value = 8;   // 5 —á–∞—Å–æ–≤
                
                updateValidation();
            }, 100);
            */
        }
    </script>
</body>
</html>